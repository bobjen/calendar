<!DOCTYPE html>
<html>
<head>
<title>Ring Simulator Test</title>
<style>
body { background: #111; color: #ccc; font-family: monospace; margin: 20px; }
canvas { border: 1px solid #444; display: block; margin: 10px 0; }
</style>
</head>
<body>
<h2>Ring Simulator Test</h2>

<p>Force verification (see browser console): ringForce(5, 2, 4, 2) should match
testforce.cpp output for the ring at (0,5,2) acting on point at (0,4,2).
The force is purely radial (fy nonzero, fz=0) since both are at z=2.</p>

<p>Click canvas to pause/resume.</p>

<h3>Three rings, equal mass, mutual attraction (trails enabled)</h3>
<canvas id="c1" width="600" height="400"></canvas>

<h3>Five rings in a pentagon, equal mass</h3>
<canvas id="c2" width="600" height="400"></canvas>

<h3>Dyson torus: central ring (green, Z=0) plus one torus orbit (red, x=y=0.1)</h3>
<p>Sun mass=1.0. Central ring at Y=1, Z=0, l=1 stays fixed (circular equatorial orbit).
Torus ring from position (0,sqrt(1-x^2),x), velocity (sqrt(1-y^2),0,y) with x=y=0.1:
Y=0.9950, Z=0.1, l=0.990, vz=0.1. Both moons have |r|=1, |v|=1 (same energy/period).
Massless rings, no self-gravity.</p>
<canvas id="c3" width="600" height="400"></canvas>

<script src="ring.js"></script>
<script>
// Force verification: compare against testforce.cpp
// Ring at (y=5, z=2), point at (y=4, z=2).
// z separation = 0, so force is purely radial (fz should be 0).
// This should match the "odd-interpolate diff" from testforce.cpp.
// Run testforce with large nMoons (e.g. 8192) to get the reference "odd" value.
// ringForce(yRing, zRing, yPoint, zPoint)
// Ring at y=5,z=2 acting on point at y=4,z=2.
// z-separation is 0, so fz should be ~0 and fy is the full radial force.
// Point is inside the ring (y=4 < y_ring=5), so fy should be positive (attracted outward).
// Python reference: fy=0.0493416525331284, fz=0
// Compare against: build/run testforce 8192 and check "interpolate" line (a._y component).
var f = ringForce(5, 2, 4, 2);
console.log("ringForce(5, 2, 4, 2) fy =", f.fy, " (ref: 0.0493416525331284)");
console.log("ringForce(5, 2, 4, 2) fz =", f.fz, " (ref: 0)");

// Three rings orbiting a central sun (mass 100, modeled as a tiny ring near the axis).
// Each ring is given l = sqrt(M_sun * Y) so it starts in a stable circular orbit.
// Small perturbations (vy, vz) let us watch the epicyclic oscillations.
// The sun is not shown (radius:0) but exerts gravity and is included in the moons list.
var Msun = 100;
ring("c1", {
    background: "#000",
    scale: 40,
    ymargin: 20,
    increment: 0.06,
    work: 30,
    framerate: 40,
    trail: true,
    traillen: 500,
    fade: 0.01,
    stop: false,
    moons: [
        // Sun: fixed on axis, treated as near-point-mass
        { y: 0.01, z: 0, vy: 0, vz: 0, mass: Msun, color: "#ffff00", radius: 4, l: 0, fixed: true },
        // Three orbital rings with Keplerian l, slightly perturbed
        { y: 3, z: 0, vy: 0.3, vz:  0.1, mass: 1, color: "#ff8800", radius: 4,
          l: Math.sqrt(Msun * 3) },
        { y: 5, z: 0, vy: 0.0, vz: -0.2, mass: 1, color: "#00aaff", radius: 4,
          l: Math.sqrt(Msun * 5) },
        { y: 7, z: 0, vy:-0.2, vz:  0.1, mass: 1, color: "#88ff00", radius: 4,
          l: Math.sqrt(Msun * 7) },
    ]
});

// Five rings in a torus cross-section, Keplerian orbits, equally spaced in radius
(function() {
    var moons = [];
    var colors = ["#ff4444","#ff9900","#ffff00","#44ff44","#4444ff"];
    // Sun
    moons.push({ y: 0.01, z: 0, vy: 0, vz: 0, mass: Msun, color: "#ffffff", radius: 4, l: 0, fixed: true });
    for (var i = 0; i < 5; i++) {
        var Y = 3 + i * 1.5;  // radii: 3, 4.5, 6, 7.5, 9
        var dz = (i % 2 === 0) ? 0.3 : -0.3;  // slight vertical offset
        moons.push({ y: Y, z: dz, vy: 0, vz: 0, mass: 1, color: colors[i], radius: 4,
                     l: Math.sqrt(Msun * Y) });
    }
    ring("c2", {
        background: "#000",
        scale: 30,
        ymargin: 20,
        increment: 0.06,
        work: 30,
        framerate: 40,
        trail: true,
        traillen: 600,
        fade: 0.008,
        stop: false,
        moons: moons,
    });
})();

// Dyson torus (orbit.js units: sun mass=1, circular orbit at r=1, period=2pi).
// Central ring: 3D position (0,1,0), velocity (1,0,0) -> Y=1, Z=0, l=1, vy=0, vz=0.
// Torus ring: position (0,sqrt(1-x^2),x), velocity (sqrt(1-y^2),0,y) with x=y=0.1
//   -> Y=sqrt(0.99), Z=0.1, l=0.99, vy=0, vz=0.1.
// Both moons have |r|=1, |v|=1 (same energy, same period 2pi). Massless, no self-gravity.
(function() {
    ring("c3", {
        background: "#000",
        scale: 400,
        ymargin: 10,
        increment: 0.06,
        work: 30,
        framerate: 40,
        trail: true,
        traillen: 600,
        fade: 0.005,
        stop: false,
        moons: [
            // Sun: mass=1.0, fixed on axis
            { y: 0.01, z: 0, mass: 1.0, color: "#ffff00", radius: 5, l: 0, fixed: true },
            // Central ring: circular equatorial orbit at Y=1, Z=0 (green)
            { y: 1, z: 0, vy: 0, vz: 0, mass: 0, color: "#44ff44", radius: 4, l: 1 },
            // Torus ring: x=0.1 position, y=0.1 velocity (red)
            { y: Math.sqrt(0.99), z: 0.1, vy: 0, vz: 0.1, mass: 0, color: "#ff4444", radius: 4, l: 0.99 },
        ],
    });
})();
</script>
</body>
</html>
